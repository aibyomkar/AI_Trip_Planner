# frontend

import streamlit as st
import requests
import datetime

BASE_URL = 'http://localhost:8000'  # Backend endpoint

st.set_page_config(
    page_title="AI Trip Planner",
    page_icon="🌏",
    layout="centered",
    initial_sidebar_state='expanded'
)

st.title('🌏 AI Trip Planner')

# Initialize chat history
if 'messages' not in st.session_state:
    st.session_state.messages = []

# Display prompt
st.header('🧭 Where shall we explore next?')

# Chat input box
with st.form(key='query_form', clear_on_submit=True):
    user_input = st.text_input('User Input', placeholder='e.g. Plan a trip to Goa for 5 days')
    submit_button = st.form_submit_button('Ask AI')

if submit_button and user_input.strip():
    try:
        with st.spinner('A.I. is thinking...'):
            payload = {'question': user_input}
            response = requests.post(f'{BASE_URL}/query', json=payload)

        if response.status_code == 200:
            answer = response.json().get('answer', 'No answer returned.')
            markdown_content = f'''
            ### 🧭 AI Trip Plan

            **Generated:** {datetime.datetime.now().strftime('%Y-%m-%d at %H:%M')}  
            **Created by:** Omkar's AI Trip Planner

            ---

            {answer}

            ---

            *Note: This trip plan was generated by AI. Please verify all details like pricing, timings, and safety measures before your trip.*
            '''
            st.markdown(markdown_content)
        else:
            st.error('❌ AI failed to respond: ' + response.text)

    except Exception as e:
        st.error(f'🚨 The response failed due to: {e}')